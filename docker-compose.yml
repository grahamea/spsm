version: '3.4'

services:

  tomcat:
    # give built image a unique name to avoid clashing with the default tomcat image
    image: spsm_tomcat
    build:
      context: ./tomcat
      dockerfile: ./Dockerfile
    ports:
      - 8068:8068
   

  haprimary:
    #primary server
    build:
      context: .
      dockerfile: ./Dockerfile
    image: spsm
    command: -haprimary
    hostname: haprimary
    environment: 
      - PRIMARYHOST=haprimary
      - BACKUPHOST=habackup
    volumes:
      - haprimary_projects_volume:/rtv/SolacePubSubMonitor/projects
    
    

  habackup:
    #backup server
    build:
      context: .
      dockerfile: ./Dockerfile
    image: spsm
    command: -habackup
    hostname: habackup
    environment:
      - PRIMARYHOST=haprimary
      - BACKUPHOST=habackup
    volumes:
      - habackup_projects_volume:/rtv/SolacePubSubMonitor/projects     

volumes:
  # volumes required for persistance so (updated) project settings survive a container restart (peristance)
  # haprimary 
  haprimary_projects_volume:
  # habackup
  habackup_projects_volume:


    


